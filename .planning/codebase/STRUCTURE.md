# Codebase Structure

**Analysis Date:** 2026-02-19

## Directory Layout

```
continuum-intelligence-v2/
├── js/dne/                  # Dynamic Narrative Engine — browser-side scoring
│   ├── app.js               # Bootstrap: initializes DNE on page load
│   ├── evidence.js          # Shared constants, decay utilities, evidence gathering
│   ├── engine.js            # Core hypothesis survival scoring logic
│   ├── price-signals.js     # Price rule evaluation and signal generation
│   ├── weighting.js         # Narrative weighting and confidence computation
│   ├── override.js          # Editorial override logic and expiry
│   ├── ui.js                # DOM rendering: bars, alerts, hypothesis cards
│   └── pdf.js               # PDF report generation (institutional/retail)
│
├── js/personalisation.js    # Client-side onboarding wizard for institutional users
│
├── scripts/                 # Backend batch processing pipeline
│   ├── update-orchestrator.js      # Master coordinator (runs full pipeline)
│   ├── update-prices.js            # Fetch latest prices from Yahoo Finance
│   ├── research-monitor.js         # Calculate research freshness metadata
│   ├── event-scraper.js            # Scrape ASX announcements + price data
│   ├── narrative-generator.js      # Classify events and generate narrative updates
│   ├── update-html.js              # Apply narrative updates to index.html
│   ├── run-automated-analysis.js   # Full analysis pipeline
│   │
│   ├── [Analysis & Signal Generation]
│   ├── calc-idio-signal.js         # Idiosyncratic price signal calculation
│   ├── calc-macro-signal.js        # Macro factor scoring
│   ├── calc-sector-signal.js       # Sector-relative signal computation
│   ├── price-narrative-engine.js   # Integrated price-narrative workflow
│   ├── price-evidence-engine.js    # Evidence generation from price moves
│   │
│   ├── [Data Utilities]
│   ├── extract-stock-data.js       # Bulk data extraction/transformation
│   ├── add-stock.js                # Add new stock to registry
│   ├── validate-coverage.js        # Validate data completeness
│   ├── snapshot-generator.js       # Create point-in-time snapshots
│   ├── lib/registry.js             # Stock registry and utilities
│   │
│   └── README.md                   # Pipeline documentation
│
├── data/                    # Persistent data and configuration
│   ├── stocks/              # Stock evidence and hypothesis profiles
│   │   ├── WOW.json         # Stock profile: ticker, hypotheses, evidence, price signals
│   │   ├── BHP.json
│   │   ├── CBA.json
│   │   ├── {ticker}-history.json  # Historical hypothesis score snapshots
│   │   └── [20 ASX200 stocks]
│   │
│   ├── config/              # System configuration
│   │   ├── tickers.json     # Registry of tracked stocks with metadata
│   │   ├── price_rules.json # Price evidence rules (trigger conditions, diagnosticity)
│   │   └── ta-config.json   # Technical analysis parameter configuration
│   │
│   ├── research/            # Research metadata and index
│   │   ├── {ticker}.json    # Research freshness metadata per stock
│   │   └── _index.json      # Aggregated index of all research coverage
│   │
│   ├── events/              # Event logs
│   │   ├── events-2026-02-15.json
│   │   ├── events-2026-02-16.json
│   │   └── events-2026-02-17.json
│   │
│   └── latest-prices.json   # Current market prices (updated by pipeline)
│
├── tests/                   # Jest test suite
│   ├── data-integrity.test.js      # Validate stock JSON schema and completeness
│   └── html-structure.test.js      # Validate generated HTML structure
│
├── continuum-beta-package/  # Archived beta deployment (legacy)
│   ├── scripts/
│   ├── index.html
│   └── [Beta version of system]
│
├── index.html               # Main static page (generated by pipeline)
├── index-v2.html            # Alternate layout version
├── stock.html               # Stock detail page template
├── thesis-comparator.html   # Multi-stock thesis comparison interface
└── thesis-comparator-v4.html  # Latest comparator version
```

## Directory Purposes

**js/dne/ — Dynamic Narrative Engine:**
- Purpose: Browser-side hypothesis scoring, UI rendering, and narrative flip detection
- Contains: Pure JavaScript modules for client-side logic
- Key files: `app.js` (entry), `engine.js` (scoring), `ui.js` (rendering)
- Execution: Loaded on every stock page; runs 15-min refresh loop
- Dependencies: No external libraries; global DOM API

**js/personalisation.js:**
- Purpose: Institutional user onboarding wizard (5-step flow)
- Contains: UI state machine, localStorage persistence, firm/strategy/portfolio data collection
- Execution: Optional; users access via personalization modal
- Output: User profile stored in localStorage, used for recommendation filtering

**scripts/ — Backend Pipeline:**
- Purpose: Batch data processing, event detection, narrative generation, deployment
- Contains: Node.js scripts orchestrated by CI/CD
- Run frequency: On-demand or 2x daily via GitHub Actions
- Output: Updated stock JSONs, refreshed index.html, event logs
- Key orchestrator: `update-orchestrator.js`

**data/stocks/ — Stock Evidence Profiles:**
- Purpose: Persistent stock-level data: hypotheses, evidence items, price signals
- Format: JSON, one file per stock
- Structure: `{ ticker, company, sector, hypotheses: { T1, T2, T3, T4 }, evidence_items, price_signals }`
- Updated by: Pipeline scripts (narrative-generator.js, price-evidence-engine.js)
- Consumed by: Browser (js/dne/app.js) and analysis scripts

**data/config/ — Configuration:**
- Purpose: System-wide and stock-specific configuration
- `tickers.json`: Registry of tracked stocks, metadata, analysis config per stock
- `price_rules.json`: Trigger conditions for price evidence rules (diagnosticity, decay, hypothesis impact)
- `ta-config.json`: Technical analysis parameters
- Updated by: Manual editing or calibration scripts

**data/research/ — Research Metadata:**
- Purpose: Track research coverage freshness and cross-stock index
- `_index.json`: Aggregated metadata (last update, coverage gaps, sector distribution)
- `{ticker}.json`: Per-stock freshness (last research update, analyst, confidence level)
- Updated by: research-monitor.js
- Consumed by: UI for coverage indicators

**data/events/ — Event Logs:**
- Purpose: Daily event capture from ASX and price data
- Format: JSON, one file per date
- Contains: Event type (Earnings, M&A, Management, etc.), timestamps, evidence generated
- Retention: Historical record; consumed by narrative-generator.js

**tests/ — Test Suite:**
- Purpose: Jest-based validation of data integrity and HTML output
- `data-integrity.test.js`: Validates stock JSON schema, ticker config consistency
- `html-structure.test.js`: Validates generated index.html structure (tables, links)
- Run: `npm test` or CI pipeline
- Coverage: scripts/, data/ (not js/dne/ — that's browser-only)

## Key File Locations

**Entry Points:**
- `index.html`: Main public page (generated by pipeline, served by GitHub Pages)
- `js/dne/app.js`: Browser DNE initialization (loaded via `<script>` tag on index.html)
- `scripts/update-orchestrator.js`: CI/CD pipeline entry point

**Configuration:**
- `data/config/tickers.json`: Stock registry with analysis parameters
- `data/config/price_rules.json`: Price evidence rules (triggers, diagnosticity, decay)
- `jest.config.js`: Jest test configuration
- `package.json`: Node.js dependencies and npm scripts

**Core Logic:**
- `js/dne/engine.js`: Hypothesis survival score recalculation
- `js/dne/price-signals.js`: Price rule evaluation and signal generation
- `js/dne/override.js`: Editorial override logic
- `scripts/narrative-generator.js`: Event classification and narrative update generation
- `scripts/run-automated-analysis.js`: Full analysis pipeline coordinator

**Testing:**
- `tests/data-integrity.test.js`: Stock data validation
- `tests/html-structure.test.js`: HTML output validation

**Data:**
- `data/stocks/{ticker}.json`: Stock evidence profiles (primary data store)
- `data/stocks/{ticker}-history.json`: Historical hypothesis score snapshots
- `data/latest-prices.json`: Current market prices

## Naming Conventions

**Files:**
- Kebab-case for scripts and HTML: `update-orchestrator.js`, `thesis-comparator.html`
- Lowercase with hyphens for data directories: `price-signals`, `evidence-items`
- Ticker symbols (ALL CAPS + exchange suffix): `WOW.AX`, `BHP.AX`
- Dates in ISO format: `events-2026-02-19.json`

**Directories:**
- Lowercase with hyphens: `js/dne/`, `data/config/`, `data/research/`
- PascalCase for archived/beta: `continuum-beta-package/`

**Functions (JavaScript):**
- camelCase for public functions: `recalculateSurvival()`, `evaluatePriceSignals()`, `updateNarrativeUI()`
- prefixed with underscore for private/internal: `_deactivateExpiredSignals()`
- UPPERCASE for constants: `DIAGNOSTICITY_WEIGHTS`, `HYPOTHESIS_IDS`, `SURVIVAL_THRESHOLDS`

**Variables:**
- camelCase for local variables: `stockUrl`, `intradayReturn`, `weightedInconsistency`
- snake_case for JSON keys (data format): `full_weight_days`, `survival_score`, `hypothesis_impact`
- ISO format for dates: `2026-02-19T15:30:00+11:00`

**HTML IDs/Classes:**
- Kebab-case for DOM selectors: `data-hypothesis="T1"`, `id="narrative-bar"`, `class="hypothesis-card"`

## Where to Add New Code

**New Feature (Stock Analysis):**
- Primary code: `scripts/calc-{feature-name}-signal.js`
- Integration: Import and call from `scripts/run-automated-analysis.js`
- Tests: `tests/{feature-name}.test.js`
- Config: Add parameters to `data/config/ta-config.json`

**New Component/Module (Browser UI):**
- Implementation: `js/dne/{component-name}.js`
- Bootstrap: Import and call from `js/dne/app.js`
- Styling: Add CSS to `<style>` block in `index.html`
- Testing: Component integration tests in `tests/html-structure.test.js`

**Utilities & Helpers:**
- Shared utilities: `scripts/lib/{module-name}.js`
- General-purpose: Add to `js/dne/evidence.js` for browser, or new `scripts/lib/` file for backend

**Data & Configuration:**
- New stock: Add entry to `data/config/tickers.json`, create `data/stocks/{ticker}.json`
- New price rule: Add to `data/config/price_rules.json` array
- New technical analysis parameter: Add to `data/config/ta-config.json`

**Tests:**
- Unit tests: `tests/{module-name}.test.js`
- Integration: `tests/data-integrity.test.js` (schema validation)
- HTML validation: `tests/html-structure.test.js`

## Special Directories

**continuum-beta-package/:**
- Purpose: Archived beta deployment
- Generated: No (manual snapshot)
- Committed: Yes (historical reference)
- Status: Read-only; not active in current pipeline

**data/stocks/ (with -history.json files):**
- Purpose: Time-series snapshots of hypothesis scores
- Generated: Yes (by `snapshot-generator.js`)
- Committed: Yes (for historical analysis)
- Update frequency: On-demand or nightly

**node_modules/:**
- Purpose: Dependencies (Jest, ESLint, @anthropic-ai/sdk)
- Generated: Yes (npm install)
- Committed: No (listed in .gitignore)
- Size: Large (avoid in git)

**.git/:**
- Purpose: Git repository metadata
- Generated: Yes (git init)
- Committed: Internal (version control)
- Status: Off-limits (do not edit manually)

---

*Structure analysis: 2026-02-19*
